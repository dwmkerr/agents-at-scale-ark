# DevSpace configuration for {{ .project.name }}
version: v2beta1

# Deployment pipelines
pipelines:
  deploy: |-
    build_images --all
    create_deployments --all

  dev: |-
    create_deployments --all
    start_dev --all

# Image build configuration
images:
  {{ .project.name }}:
    image: {{ .devspace.image.repository }}
    dockerfile: ./Dockerfile
    context: ./

# Kubernetes deployments
deployments:
  {{ .project.name }}:
    namespace: {{ .devspace.namespace }}
    helm:
      chart:
        path: ./chart
      values:
        app:
          image:
            repository: ${runtime.images.{{ .project.name }}.image}
            tag: ${runtime.images.{{ .project.name }}.tag}

# Development configuration
dev:
  {{ .project.name }}:
    imageSelector: {{ .project.name }}
    devImage: python:{{ .python.version }}-slim
    command: ["sh", "-c", "cd /app && python -m {{ .python.module_name }}"]
    namespace: {{ .devspace.namespace }}
    logs:
      lastLines: 50
    sync:
      - path: ./:/app
        startContainer: true
        excludePaths:
          - .git/
          - .devspace/
          - .venv/
          - venv/
          - __pycache__/
          - "*.pyc"
          - Dockerfile
          - devspace.yaml
          - chart/
    ssh:
      enabled: true